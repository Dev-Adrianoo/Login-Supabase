<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="inicio.css" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="supabase.js" defer></script>
    <link
      href="https://cdn.jsdelivr.net/npm/@iconscout/unicons/css/line.css"
      rel="stylesheet"
    />
    <title>Bem-vindo</title>
  </head>
  <body class="body-2">
    <div class="divSearch">
      <input
        type="text"
        class="Search"
        placeholder="Pesquisar..."
        id="SearchBar"
        onkeyup="filtrarItens()"
      />
      <i class="uil uil-search"></i>
    </div>
    <div class="container-row">
      <div class="menu-hamburguer" onclick="toggleSidebar()">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <div class="sidebar">
        <div class="imageDivPai">
          <div id="usuarioInfo" class="usuario-info">
            <div class="animate-blop2">
              <svg
                viewBox="0 0 500 500"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                width="100%"
                id="blobSvg"
              >
                <path fill="#FFFFFF">
                  <animate
                    attributeName="d"
                    dur="10000ms"
                    repeatCount="indefinite"
                    values="
                  M427.5,358Q375,466,273,426.5Q171,387,95.5,318.5Q20,250,74,144.5Q128,39,244.5,48Q361,57,420.5,153.5Q480,250,427.5,358Z;
                  M387,336.5Q350,423,245.5,431Q141,439,132.5,344.5Q124,250,144,176Q164,102,267,72Q370,42,397,146Q424,250,387,336.5Z;
                  M379.5,325.5Q337,401,232.5,430.5Q128,460,119,355Q110,250,144,188Q178,126,246.5,132Q315,138,368.5,194Q422,250,379.5,325.5Z;
                  M427.5,358Q375,466,273,426.5Q171,387,95.5,318.5Q20,250,74,144.5Q128,39,244.5,48Q361,57,420.5,153.5Q480,250,427.5,358Z;
                  "
                  ></animate>
                </path>
              </svg>
            </div>
            <img
              class="imagem-perfil"
              src="images/foto-perfil.jpg"
              loading="lazy"
            />
            <p id="nomeCompleto">Carregando...</p>
            <h2 id="mensagem">Carregando...</h2>
          </div>
          <hr />
          <ul class="list-topics">
            <li><a href="#">Início</a></li>
            <li><a href="perfil.html">Perfil</a></li>
            <li><a href="#">Ajuda</a></li>
            <li><a href="#" onclick="logout()">Sair</a></li>
          </ul>
        </div>
      </div>
      <div class="cards-container">
        <div class="card" onclick="abrirModal('modal-1', event)">
          <div class="card-image" loading="lazy"></div>
          <h2>Segurança Cibernética</h2>
          <p>Lorem ipsum dolor sit amet consectetur...</p>
          <div class="interativeIcons">
            <span class="spanCount">
              <img
                src="images/coracao.png"
                class="heart-icon"
                data-id="1"
              />
              <span class="like-count">0</span>
            </span>

            <span>
              <img src="images/comente.png" />
            </span>
            <span><img src="images/mail-send.png" /></span>
          </div>
        </div>
        <div id="modal-1" class="modal">
          <div class="modal-content">
            <span class="close" onclick="fecharModal('modal-1', event)">X</span>
            <h2>Segurança Cibernética</h2>
            <p>
              Detalhes sobre segurança cibernética: proteção contra ataques
              digitais e mais. Lorem ipsum dolor sit amet consectetur
              adipisicing elit...
            </p>
            <div class="comentarios">
              <h3>Comentários</h3>
              <div class="lista-comentarios" id="comentarios-list-1"></div>
              <textarea
                id="comentarioInput-1"
                placeholder="Digite seu Comentário..."
              ></textarea>
              <div class="comentario-container">
                <button class="btnSubmit" onclick="enviarComentario(1)">
                  Comentar
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="card" onclick="abrirModal('modal-2', event)">
          <div class="card-image" loading="lazy">
            <img
              src="images/privacidade-web.webp"
              alt="imagem-privacidade-web"
            />
          </div>
          <h2>Privacidade Web</h2>
          <p>Lorem ipsum dolor sit amet consectetur...</p>
          <div class="interativeIcons">
            <span class="spanCount"
              ><img
                src="images/coracao.png"

                class="heart-icon"
                data-id="2"
              />
              <span class="like-count">0</span>
            </span>
            <span class="spanCount">
              <img src="images/comente.png" />
              <span class="coments-count">0</span>
            </span>
            <span><img src="images/mail-send.png" /></span>
          </div>
        </div>
        <div id="modal-2" class="modal">
          <div class="modal-content">
            <span class="close" onclick="fecharModal('modal-2', event)">X</span>
            <h2>Privacidade Web</h2>
            <p>
              Detalhes sobre privacidade na web: como proteger seus dados
              online.
            </p>

            <div class="comentarios">
              <h3>Comentários</h3>
              <div class="lista-comentarios" id="comentarios-list-2"></div>
              <textarea
                id="comentarioInput-2"
                placeholder="Digite seu Comentário..."
              ></textarea>
              <div class="comentario-container">
                <button class="btnSubmit" onclick="enviarComentario(2)">
                  Comentar
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="card" onclick="abrirModal('modal-3',event)">
          <div class="card-image" loading="lazy">
            <img src="images/pshing.webp" alt="pshing-image" />
          </div>
          <h2>Phishing</h2>
          <p>Lorem ipsum dolor sit amet consectetur...</p>
          <div class="interativeIcons">
            <span class="spanCount">
              <img
                src="images/coracao.png"
                class="heart-icon"
                data-id="3"
              />
              <span class="like-count">0</span>
            </span>
            <span class="spanCount">
              <img src="images/comente.png" />
              <span class="coments-count">0</span>
            </span>
            <span><img src="images/mail-send.png" /></span>
          </div>
        </div>

        <div id="modal-3" class="modal">
          <div class="modal-content">
            <span class="close" onclick="fecharModal('modal-3', event)">X</span>
            <h2>Phishing</h2>
            <p>
              Detalhes sobre phishing: técnicas usadas por hackers para enganar
              usuários e roubar informações pessoais.
            </p>

            <div class="comentarios">
              <h3>Comentários</h3>
              <div class="lista-comentarios" id="comentarios-list-3"></div>
              <textarea
                id="comentarioInput-3"
                placeholder="Digite seu Comentário..."
              ></textarea>
              <div class="comentario-container">
                <button class="btnSubmit" onclick="enviarComentario(3)">
                  Comentar
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="card" onclick="abrirModal('modal-4', event)">
          <div class="card-image" loading="lazy">
            <img
              src="images/desenvolvimento-web.webp"
              alt="desenvolvimento-web"
            />
          </div>
          <h2>Desenvolvimento Web</h2>
          <p>Lorem ipsum dolor sit amet consectetur...</p>
          <div class="interativeIcons">
            <span class="spanCount">
              <img
                src="images/coracao.png"
                class="heart-icon"
                data-id="4"
              />
              <span class="like-count">0</span>
            </span>
            <span class="spanCount">
              <img src="images/comente.png" />
              <span class="coments-count">0</span>
            </span>
              <img src="images/mail-send.png" />
            </span>
          </div>
        </div>

        <div id="modal-4" class="modal">
          <div class="modal-content">
            <span class="close" onclick="fecharModal('modal-4')">X</span>
            <h2>Desenvolvimento Web</h2>
            <p>
              Detalhes sobre desenvolvimento web: HTML, CSS, JavaScript e mais.
            </p>
            <div class="comentarios">
              <h3>Comentários</h3>
              <div class="lista-comentarios" id="comentarios-list-4"></div>
              <textarea
                id="comentarioInput-4"
                placeholder="Digite seu Comentário..."
              ></textarea>
              <div class="comentario-container">
                <button class="btnSubmit" onclick="enviarComentario(4)">
                  Comentar
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="card" onclick="abrirModal('modal-5',event)">
          <div class="card-image" loading="lazy">
            <img
              src="images/redes-computadores.webp"
              alt="redes-computadores"
            />
          </div>
          <h2>Redes de Computadores</h2>
          <p>Lorem ipsum dolor sit amet consectetur...</p>
          <div class="interativeIcons">
            <span class="spanCount">
              <img
                src="images/coracao.png"
                class="heart-icon"
                data-id="5"
              />
              <span class="like-count">0</span>
            </span>
            <span class="spanCount">
              <img src="images/comente.png" />
              <span class="coments-count">0</span>
            </span>
              <img src="images/mail-send.png" />
            </span>
          </div>
        </div>

        <div id="modal-5" class="modal">
          <div class="modal-content">
            <span class="close" onclick="fecharModal('modal-5')">X</span>
            <h2>Redes de Computadores</h2>
            <p>
              Detalhes sobre redes de computadores: protocolos e infraestrutura.
            </p>
            <div class="comentarios">
              <h3>Comentários</h3>
              <div class="lista-comentarios" id="comentarios-list-5"></div>
              <textarea
                id="comentarioInput-5"
                placeholder="Digite seu Comentário..."
              ></textarea>
              <div class="comentario-container">
                <button class="btnSubmit" onclick="enviarComentario(5)">
                  Comentar
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="card" onclick="abrirModal('modal-6',event)">
          <div class="card-image" loading="lazy">
            <img src="images/programacao.webp" alt="imagem programação" />
          </div>
          <h2>Programação</h2>
          <p>Lorem ipsum dolor sit amet consectetur...</p>
          <div class="interativeIcons">
            <span class="spanCount">
              <img
                src="images/coracao.png"
                class="heart-icon"
                data-id="6"
              />
              <span class="like-count">0</span>
            </span>
            <span class="spanCount">
              <img src="images/comente.png" />
              <span class="coments-count">0</span>
            </span>
              <img src="images/mail-send.png" />
            </span>
          </div>
        </div>

        <div id="modal-6" class="modal">
          <div class="modal-content">
            <span class="close" onclick="fecharModal('modal-6')">X</span>
            <h2>Programação</h2>
            <p>Detalhes sobre programação: linguagens e lógica de código.</p>
            <div class="comentarios">
              <h3>Comentários</h3>
              <div class="lista-comentarios" id="comentarios-list-6"></div>
              <textarea
                id="comentarioInput-6"
                placeholder="Digite seu Comentário..."
              ></textarea>
              <div class="comentario-container">
                <button class="btnSubmit" onclick="enviarComentario(6)">
                  Comentar
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="card" onclick="abrirModal('modal-7',event)">
          <div class="card-image" loading="lazy">
            <img src="images/IA.webp" alt="Inteligência Artificial" />
          </div>
          <h2>Inteligência Artificial</h2>
          <p>Lorem ipsum dolor sit amet consectetur...</p>
          <div class="interativeIcons">
            <span class="spanCount">
              <img
                src="images/coracao.png"
                class="heart-icon"
                data-id="7"
              />
              <span class="like-count">0</span>
            </span>
            <span class="spanCount">
              <img src="images/comente.png" />
              <span class="coments-count">0</span>
            </span>
              <img src="images/mail-send.png" />
            </span>
          </div>
        </div>

        <div id="modal-7" class="modal">
          <div class="modal-content">
            <span class="close" onclick="fecharModal('modal-7')">X</span>
            <h2>Inteligência Artificial</h2>
            <p>
              Detalhes sobre inteligência artificial: aprendizado de máquina e
              mais.
            </p>
            <div class="comentarios">
              <h3>Comentários</h3>
              <div class="lista-comentarios" id="comentarios-list-7"></div>
              <textarea
                id="comentarioInput-7"
                placeholder="Digite seu Comentário..."
              ></textarea>
              <div class="comentario-container">
                <button class="btnSubmit" onclick="enviarComentario(7)">
                  Comentar
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="card" onclick="abrirModal('modal-8',event)">
          <div class="card-image" loading="lazy">
            <img src="images/big-data.webp" alt="Big Data" />
          </div>
          <h2>Big Data</h2>
          <p>Lorem ipsum dolor sit amet consectetur...</p>
          <div class="interativeIcons">
            <span class="spanCount">
              <img
                src="images/coracao.png"
                class="heart-icon"
                data-id="8"
              />
              <span class="like-count">0</span>
            </span>
            <span class="spanCount">
              <img src="images/comente.png" />
              <span class="coments-count">0</span>
            </span>
            <span>
              <img src="images/mail-send.png" />
            </span>
          </div>
        </div>

        <div id="modal-8" class="modal">
          <div class="modal-content">
            <span class="close" onclick="fecharModal('modal-8')">X</span>
            <h2>Big Data</h2>
            <p>Detalhes sobre big data: análise de grandes volumes de dados.</p>
            <div class="comentarios">
              <h3>Comentários</h3>
              <div class="lista-comentarios" id="comentarios-list-8"></div>
              <textarea
                id="comentarioInput-8"
                placeholder="Digite seu Comentário..."
              ></textarea>
              <div class="comentario-container">
                <button class="btnSubmit" onclick="enviarComentario(8)">
                  Comentar
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="card" onclick="abrirModal('modal-9', event)">
          <div class="card-image" loading="lazy">
            <img src="images/machine-learning.webp" alt="Machine Learning" />
          </div>
          <h2>Machine Learning</h2>
          <p>Lorem ipsum dolor sit amet consectetur...</p>
          <div class="interativeIcons">
            <span class="spanCount">
              <img
                src="images/coracao.png"
                class="heart-icon"
                data-id="9"
              />
              <span class="like-count">0</span>
            </span>
            <span class="spanCount">
              <img src="images/comente.png" />
              <span class="coments-count">0</span>
            </span>
            <span>
              <img src="images/mail-send.png" />
            </span>
          </div>
        </div>

        <div id="modal-9" class="modal">
          <div class="modal-content">
            <span class="close" onclick="fecharModal('modal-9')">X</span>
            <h2>Machine Learning</h2>
            <p>Detalhes sobre machine learning: algoritmos e aplicações.</p>
            Lorem ipsum dolor sit, amet consectetur adipisicing elit. Alias,
            eligendi placeat, laboriosam asperiores numquam molestiae voluptate
            eius nam recusandae dolorum eaque at ut deleniti molestias in. Sint,
            unde. Molestiae, enim! Lorem ipsum dolor sit amet consectetur
            adipisicing elit. Deserunt fuga sint, voluptate possimus labore
            ducimus quod reiciendis ipsam nesciunt asperiores harum quos
            cupiditate assumenda est aliquid dolores vero, nobis culpa! Lorem
            ipsum dolor sit amet consectetur, adipisicing elit. Voluptatem porro
            tempore est quos ullam explicabo, beatae officiis maiores sed quae
            dicta excepturi earum veritatis enim aliquid totam dolorem et
            cumque! Lorem ipsum dolor sit amet consectetur, adipisicing elit. Ut
            ratione, veniam repellat qui quibusdam numquam natus saepe fuga
            ducimus! Dolor iure aliquid eius suscipit ut minima accusamus
            maiores quibusdam fuga.
            <div class="comentarios">
              <h3>Comentários</h3>
              <div class="lista-comentarios" id="comentarios-list-9"></div>
              <textarea
                id="comentarioInput-9"
                placeholder="Digite seu Comentário..."
              ></textarea>
              <div class="comentario-container">
                <button class="btnSubmit" onclick="enviarComentario(9)">
                  Comentar
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>




  <script>

    let userEmail = "";
    const heartIcons = document.querySelectorAll(".heart-icon");

    async function init() {
      await getUser();
      
      for (const icon of heartIcons) {
        const id = icon.getAttribute(`data-id`);

  
    const { data: existingLike } = await supabase
      .from('likes')
      .select('id')
      .eq('post_id', id)
      .eq('user_email', userEmail)
      .maybeSingle()

    if (existingLike) {
      icon.classList.add("liked");
      icon.src = "images/coracao-hover.png";
  }

  updateLikeCount(icon, id);

  icon.addEventListener("click", (event) => {
    event.stopPropagation()
    toggleLike(event)
  });
}
}

    window.addEventListener('DOMContentLoaded', init);

    const cardsContainer = document.querySelector(".cards-container");
    const searchBar = document.querySelector(".divSearch");

    window.addEventListener("DOMContentLoaded", () => {
      cardsContainer.classList.add("centralizar");
      searchBar.classList.add("centralizar");
      searchBar.classList.remove("lado");

      setTimeout(() => {
        cardsContainer.classList.add("aparecer");
        searchBar.classList.add("aparecer")
      }, 100)
    })
    

    function toggleSidebar() {
      const sidebar = document.querySelector(".sidebar");
      sidebar.classList.toggle("ativa");

      if (sidebar.classList.contains("ativa")) {
        cardsContainer.classList.remove("centralizar");
        searchBar.classList.add("lado");
        searchBar.classList.remove("centralizar");
      } else {
        cardsContainer.classList.add("centralizar");
        searchBar.classList.add("centralizar");
        searchBar.classList.remove("lado");
      }
    }

    const usuarioEmail = localStorage.getItem("usuarioEmail");

    document.getElementById("mensagem").innerText =
      usuarioEmail || "Usuário não autenticado!";

    const nomeEmail = usuarioEmail ? usuarioEmail.split("@")[0] : "";

    const nomes = nomeEmail.split(/[.\-_]/);

    const primeiroNome = nomes[0] || "";
    const segundoNome = nomes[1] || "";

    const nomeCompleto = (primeiroNome + " " + segundoNome).trim();

    document.getElementById("nomeCompleto").innerHTML =
      nomeCompleto || "Nome não encontrado!";


  async function getUser() {
    const { data: { user }, error } = await supabase.auth.getUser();
      if (error) {
        console.log("Erro ao pegar usuário:", error);
          return;
  }
        userEmail = user.email;
}

async function toggleLike(event) {
  event.preventDefault();
  event.stopPropagation();

  const heartIcon = event.currentTarget;
  const id = heartIcon.getAttribute("data-id");

  const { data: existingLike, error } = await supabase
  .from('likes')
  .select('id')
  .eq('post_id', id)
  .eq('user_email', userEmail)
  .maybeSingle();



    if (error) {
    console.error('Erro ao buscar like:', error);
    return;
  }


  if (existingLike) {
    await supabase.from('likes').delete().eq('id', existingLike.id);
    heartIcon.classList.remove("liked");
    heartIcon.src = "images/coracao.png";
  } else {
    await supabase.from('likes').insert([
      { post_id: id, user_email: userEmail }
    ]);
    heartIcon.classList.add("liked");
    heartIcon.src = "images/coracao-hover.png";
  }

  updateLikeCount(heartIcon, id);
}

async function updateLikeCount(heartIcon, id) {
  const { count } = await supabase
    .from('likes')
    .select('*', { count: 'exact' })
    .eq('post_id', id);

  const likeCountSpan = heartIcon.nextElementSibling;
  likeCountSpan.textContent = count;
}


    function logout() {
      localStorage.removeItem("usuarioEmail");
      window.location.href = "cadastro.html";
    }

    let timeoutId = null;

    const containerCards = document.querySelector(".cards-container");
    const mensagemVazia = document.createElement("p");
    mensagemVazia.classList.add("mensagem-vazia");
    mensagemVazia.textContent = "Nenhum resultado encontrado...";

    function filtrarItens() {
      if (timeoutId) {
        clearTimeout(timeoutId);
      }

      timeoutId = setTimeout(() => {
        const filtro = document.getElementById("SearchBar").value.toLowerCase();
        const cards = document.querySelectorAll(".card");

        if (!document.getElementById("filter-style")) {
          const style = document.createElement("style");
          style.id = "filter-style";
          style.innerHTML = ".card-hidden { display: none !important; }";
          document.head.appendChild(style);
        }

        let updates = [];

        cards.forEach((card) => {
          const titulo = card.querySelector("h2").textContent.toLowerCase();
          const shouldBeVisible = titulo.includes(filtro);

          updates.push({
            element: card,
            makeVisible: shouldBeVisible,
          });
        });

        requestAnimationFrame(() => {
          updates.forEach((update) => {
            if (update.makeVisible) {
              update.element.classList.remove("card-hidden");
            } else {
              update.element.classList.add("card-hidden");
            }
          });

          const algumVisivel = updates.some((update) => update.makeVisible);
          const msgExistente = containerCards.querySelector(".mensagem-vazia");

          if (!algumVisivel) {
            if (!msgExistente) {
              containerCards.appendChild(mensagemVazia);
            }
          } else {
            if (msgExistente) {
              msgExistente.remove();
            }
          }
        });
      }, 300);
    }
    document
      .getElementById("SearchBar")
      .addEventListener("input", filtrarItens);

    function abrirModal(modalId, event) {
      const modal = document.getElementById(modalId);
      const modalContent = modal.querySelector(".modal-content");

      modal.style.display = "flex";

      setTimeout(() => {
        modalContent.style.transform = "scale(1)";
        modalContent.style.opacity = "1";
      }, 10);

      const id = modalId.split("-")[1];
      carregarComentarios(id);
    }

    function fecharModal(modalId) {
      const modal = document.getElementById(modalId);
      const modalContent = modal.querySelector(".modal-content");

      modalContent.style.transform = "scale(0.8)";
      modalContent.style.opacity = "0";

      setTimeout(() => {
        modal.style.display = "none";
      }, 300);
    }

    document.querySelectorAll(".modal").forEach((modal) => {
      modal.addEventListener("click", function (event) {
        if (event.target === modal) {
          fecharModal(modal.id);
        }
      });
    });

    const cards = document.querySelectorAll(".card");

    cards.forEach((card, index) => {
      card.addEventListener("click", (event) => {
        if (!event.target.classList.contains("close")) {
          abrirModal(`modal-${index + 1}`);
        }
      });
    });

    document.addEventListener("DOMContentLoaded", function () {
      const cardsContainer = document.querySelector(".cards-container");
      const cards = document.querySelectorAll(".card");

      cards.forEach((card) => {
        card.addEventListener("mouseenter", function () {
          cardsContainer.classList.add("card-being-hovered");

          this.classList.add("card-hovered");
        });

        card.addEventListener("mouseleave", function () {
          cardsContainer.classList.remove("card-being-hovered");

          this.classList.remove("card-hovered");
        });
      });
    });

    function enviarComentario(id) {
      const input = document.getElementById(`comentarioInput-${id}`);
      const lista = document.getElementById(`comentarios-list-${id}`);
      const texto = input.value.trim();

      if (texto !== "") {
        const comentarioDiv = document.createElement("div");
        comentarioDiv.classList.add("comentario");
        comentarioDiv.textContent = texto;
        lista.appendChild(comentarioDiv);

        const chave = `comentarios-${id}`;
        const comentariosSalvos = JSON.parse(
          localStorage.getItem(chave) || "[]"
        );
        comentariosSalvos.push(texto);
        localStorage.setItem(chave, JSON.stringify(comentariosSalvos));

        input.value = "";
      }
    }

    function carregarComentarios(id) {
      const lista = document.getElementById(`comentarios-list-${id}`);
      const chave = `comentarios-${id}`;
      const comentariosSalvos = JSON.parse(localStorage.getItem(chave) || "[]");

      lista.innerHTML = "";

      comentariosSalvos.forEach((comentario) => {
        const comentarioDiv = document.createElement("div");
        comentarioDiv.classList.add("comentario");
        comentarioDiv.textContent = comentario;
        lista.appendChild(comentarioDiv);
      });
    }
  </script>
</html>
